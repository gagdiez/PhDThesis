\section{Creando tractogramas a partir de las semillas}
\label{sec:tractogramas}

Un tractograma es una imagen donde cada voxel representa la probabilidad de que
ese punto del cerebro est\'e conectado a la semilla elegida mediante un conjunto
de axones. Una forma de crear el tractograma de una semilla es computar un mapa 
de transiciones probabil\'istico entre los voxels del cerebro; luego generar un
gran n\'umero de streamlines desde la semilla y finalmente calcular la frecuencia
de visitas por cada voxel. Se denomina \textit{streamline} al camino que puede 
realizar una part\'icula de agua siguiendo un mapa probabil\'is\-tico de transiciones
entre voxels. El siguiente pseudoc\'odigo denota este proceso:\\

\newlength\mylen
\settowidth\mylen{procedure21 crear\_tractograma(}
\addtolength\mylen{\parindent}

\begin{algorithm}
\caption{Proceso de creaci\'on de un tractograma}\label{euclid}
\begin{algorithmic}[1]

\Procedure{crear\_tractograma(anatomica: img. anat\'omica, \\ \hspace*{\mylen}
                              dMRI: img. de difusi\'on, \\ \hspace*{\mylen}
                              S: semilla, P: num. part\'iculas, \\ \hspace*{\mylen}
                              step: tam. de paso)}{}

\State \emph{mapa\_probabilistico} $\gets$ generar mapa desde \emph{dMRI} 
\State \emph{mapa\_visitas} $\gets$ copy(\emph{anatomica})
\State \emph{mapa\_visitas[:,:]} $\gets$ \emph{0} 

\For {p in [1$\dots$P]}

    \State \emph{streamline$_p$} $\gets \emptyset$
    \State \emph{posicion\_actual} $\gets$ posicion de S
    
    \While {not criterio de parada}

        \State \emph{direccion\_actual} $\gets$ elegir direccion desde \emph{mapa\_probabilistico}
        
        \State \emph{posicion\_actual} $\gets$ avanzar una distancia \emph{step} en \emph{direccion\_actual} 
                
        \State \emph{streamline$_p$} $\gets$ agregar \emph{posicion\_actual}    
   
    \EndWhile
    
    \For {\emph{pos} in \emph{streamline$_p$}}
        \State \emph{mapa\_visitas[pos]} $\gets$ \emph{mapa\_visitas[pos]} + 1
    \EndFor        
    
\EndFor

\State \emph{tractograma} $\gets$ mapa\_visitas / P
\State \Return \emph{tractograma} 
 
\EndProcedure
\end{algorithmic}

\end{algorithm}

Es importante destacar que el crear los tractogramas de esta manera genera un 
sesgo respecto a la distancia. Cuanto m\'as lejos est\'a un voxel mayor es el 
n\'umero de transiciones probabil\'isticas necesarias para llegar a \'el. Esto 
provoca que los voxels lejanos tengan valores peque\~nos. Para quitar este sesgo
Moreno-Dominguez et al. \cite{Moreno-Dominguez2014} proponen crear los tractogramas
de la siguiente manera:

\begin{equation}
\label{eq:normalizacion}
T_i = \frac{ log(M_i + 1)}{log(p+1)}
\end{equation}

Donde $T_i$ es el valor del voxel $i$ en el tractograma resultante; $M_i$ es 
el valor del voxel $i$ en el mapa de visitar y $p$ es el n\'umero de part\'iculas
usadas. Esto nos permite evitar el sesgo producto de la distancia que obtendr\'iamos
al dividir por la cantidad de part\'iculas utilizadas. Dado que 
$M_i \leq p, \forall i \in [1..N]$ cada voxel del tractograma tendr\'a un valor
entre uno y cero. $T_i = 1$ representa que todos los \textit{streams} pasaron por
el voxel, mientras que $T_i = 0$ representa que ninguno pas\'o. \\
