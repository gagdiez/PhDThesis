\section{Parcelando la corteza en el espacio eucl\'ideo} 
\label{ch:nuestro}

En la secci\'on anterior presentamos las ventajas de transformar los
tractogramas a un espacio eucl\'ideo. Mostramos que es posible realizar
\textit{clustering} con mejor complejidad espacial y temporal que el 
m\'etodo Moreno-Dominguez. Ahora nos proponemos explicar todos los pasos
que seguimos para parcelar la corteza de un sujeto. Tambi\'en presentamos
el algoritmo de clustering en su totalidad. Recordemos del cap\'itulo 
\ref{ch:metodos} que primero es necesario adquirir los datos de un sujeto;
luego seleccionar los voxels que ser\'an utilizados como semilla de cada
tractograma; generar un tractograma por cada semilla y finalmente
agruparlos usando alg\'un algoritmo de clustering. \\

\subsection{Pre-clustering}
\label{sec:preclustering}
Descargamos los datos de una mujer diestra de entre 23 y 26 a\~nos de 
\textit{The Human Connectome Project} \cite{VanEssen2012}. Usando el 
m\'etodo descrito en la secci\'on \ref{sec:semillas} situamos semillas en
la materia blanca a $3mm$ de la corteza. Por cada semilla creamos un
tractograma usando quince mil part\'iculas. Los tractogramas fueron 
generados con el algoritmo \ref{alg:itract} presentado en la secci\'on 
\label{sec:convergencia}. Descartamos aquellos tractogramas que pose\'ian
solo un voxel visitado. A su vez, los voxels de cada tractograma con valor
menor a $0.25$ fueron transformados en cero. Recordemos que los
tractogramas provienen de la ecuaci\'on \ref{eq:normalizacion}. Esto
implica que dichos voxels fueron visitados por menos del $0.006\%$ de las
part\'iculas. \\

\settowidth\mylen{procedure Parcelamiento(}
\addtolength\mylen{\parindent}

\begin{algorithm}[h!]
\caption{Parcelamiento de la corteza cerebral}\label{alg:preclustering}
\begin{algorithmic}[1]

\Procedure{Parcelamiento(K: primeros pasos del clustering, \\ \hspace*{\mylen}
                         semillas: semillas, \\ \hspace*{\mylen}
                         dMRI:img. de difusi\'on, \\ \hspace*{\mylen}
                         anatomica: img. anat\'omica) }{}

\State \emph{n\_semillas} $\gets$ len(\emph{semillas})
\State \emph{tam\_anatomica} $\gets$ size(\emph{anatomica})

\State \emph{rala\_tractos} $\gets$ matriz rala de \emph{n\_semillas} $\times$ \emph{tam\_anatomica}

\State \emph{infinito\_neg} $\gets$ logit($\epsilon$)

\For{S in \emph{semillas}}
    \State \emph{tracto\_actual} $\gets$ tractograma(\emph{dMRI}, \emph{anatomica}, \emph{S})
    \State \emph{tracto\_logit} $\gets$ map(logit, \emph{tracto\_actual})
    \State \emph{tracto\_logit\_traslacion} $\gets$ \emph{tracto\_logit} - \emph{infinito\_neg}
    
    \State \emph{rala\_tractos} $\gets$ agregar \emph{tracto\_logit\_traslacion} como fila 
\EndFor

\State \emph{vecinos} $\gets$ matriz cuadrada de dimensiones \emph{n\_semillas} $\times$
                                                             \emph{n\_semillas}

\State \emph{distancias} $\gets$ matriz cuadrada de dimensiones \emph{n\_semillas} $\times$
                                                             \emph{n\_semillas}

\State \emph{vecinos} $\gets$ \emph{semillas} que estan fisicamente a cierta distancia 
                                                             
\State \emph{distancias} $\gets$ distancia euclidea entre todos los pares de \emph{semillas}

\State \emph{clusters} $\gets$ CLUSTERING(\emph{vecinos}, \emph{distancias})

\State \Return \emph{clusters} 
 
\EndProcedure 

\end{algorithmic}
\end{algorithm}

Cada tractograma fue transformado al espacio eucl\'ideo utilizando la 
funci\'on \textit{logit} presentada en la secci\'on \ref{sec:logit} y 
\ref{sec:modificandoClustering}. Luego todos fueron trasladados linealmente
como explicamos en la secci\'on \ref{sec:ralas}. Usando cada tractograma
como una fila creamos una matriz CSR y calculamos la matriz de distancias
entre ellos mediante la Ecuaci\'on \label{eq:simileuc}. Finalmente,
definimos como vecinos a los voxels que se encuentran a una distancia
menor a $3mm$ entre si. \\  

El algoritmo \ref{alg:preclustering} muestra y resume lo dicho en forma de
pseudoc\'odigo. Este proceso de creaci\'on de estructuras posee la misma
complejidad tanto en nuestro m\'etodo como en el de Moreno-Dominguez. \\

\subsection{Algoritmo de clustering}
\label{sec:nuestro_clustering}

Comparando nuestro algoritmo de \textit{clustering} 
(algoritmo \ref{alg:nuestrometodo}) con el de Moreno-Dominguez 
(algoritmo \ref{alg:morenoahc}) se pueden ver explicitamente las
diferencias. Veamos como nuestro m\'etodo se traduce en una mayor
eficiencia espacial y temporal. \\

\settowidth\mylen{procedure Clustering(}
\addtolength\mylen{\parindent}

\begin{algorithm}[h!]
\caption{Clustering de tractogramas}\label{alg:nuestrometodo}
\begin{algorithmic}[1]

\Procedure{Clustering(k\_pasos: primeros K pasos, \\ \hspace*{\mylen}
                      vecinos: mat. de vecinos, \\ \hspace*{\mylen}
                      distancias: mat. de distancia clusters ) }{}
                      
    \State \emph{jerarquia} $\gets \emptyset$
    \State \emph{clusters} $\gets$ [1$\dots$len(distancias)]                  
                      
\For{\emph{k} in [1, len(\emph{distancias})] }

    \If{\emph{k} $>$ \emph{k\_pasos}}

        \State \emph{$C_x$, $C_y$} $\gets$ clusters tales que $x$ e $y$ poseen \emph{distancia} minima      
            
    \Else{}

        \State \emph{$C_x$, $C_y$} $\gets$ $x$ e $y$ son \emph{vecinos}; 
                                   de \emph{distancia} minima y de tama\~no similar.

    \EndIf
    
    \State {clusters} $\gets$ eliminar clusters $C_x$, $C_y$
    \State {clusters} $\gets$ agregar el numero del centroide $(C_x,C_y)$ 
                          
    \State \emph{jerarquia} $\gets$ agregar la union $(C_x,C_y)$
    
    \For{ $C_z$ in \emph{clusters} }
        \State \emph{D} $\gets$ distancia de $C_z$ al centroide usando la formula Lance y Williams
        \State \emph{distancias} $\gets$ actualizar distancia entre $(C_x,C_y)$ y $C_z$ con \emph{D}
    \EndFor            
    
\EndFor


\State \Return \emph{jerarquia} 
 
\EndProcedure 

\end{algorithmic}
\end{algorithm}

El m\'etodo de Moreno-Dominguez necesita mantener en memoria los
tractogramas durante el clustering. En nuestro algoritmo basta con tener
la matriz de distancia para generar la jerarqu\'ia. Por lo visto en la
secci\'on \ref{sec:ralas} esto implica un ahorro significativo de memoria.
Luego, al momento de calcular las distancias al nuevo centroide 
(linea 15, algoritmo \ref{alg:nuestrometodo}) usamos la formula de Lance y
Williams. \\

Supongamos un numero $s$ de semillas y una cantidad $m$ de voxels por cada
tractograma. Nuestro algoritmo de clustering posee complejidad espacial 
$O(s^2)$ contra $O(s^2 + sm)$ del m\'etodo Moreno-Dominguez. A su vez, la
complejidad temporal de nuestro algoritmo es $O(s^2m)$ contra $O(s^2)$ del
m\'etodo Moreno-Dominguez. Recordemos de la secci\'on \ref{sec:ralas} que
dentro del contexto de este trabajo $m >> s$. \\

Una vez finalizado el $clustering$ obtenemos como resultado un 
dendrograma. Para parcelar la corteza solo es necesario seleccionar una
altura en la cual cortar dicho dendrograma. Los clusters que est\'en por
debajo de ese corte ser\an las distintas parcelas.

